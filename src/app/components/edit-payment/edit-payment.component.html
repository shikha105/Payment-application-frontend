<div>
  <h2>Edit Payment</h2>
</div>

<form [formGroup]="paymentForm" (ngSubmit)="updatePayment()">
  <mat-form-field appearance="fill" class="full-width">
    <mat-label>First Name</mat-label>
    <input matInput formControlName="payee_first_name" required readonly />
    <mat-error
      *ngIf="paymentForm.get('payee_first_name')?.hasError('required')"
    >
      First name is required.
    </mat-error>
  </mat-form-field>

  <mat-form-field appearance="fill" class="full-width">
    <mat-label>Last Name</mat-label>
    <input matInput formControlName="payee_last_name" required readonly />
    <mat-error *ngIf="paymentForm.get('payee_last_name')?.hasError('required')">
      Last name is required.
    </mat-error>
  </mat-form-field>

  <mat-form-field appearance="fill" class="full-width">
    <mat-label>Added Date</mat-label>
    <input
      matInput
      [matDatepicker]="picker1"
      formControlName="payee_added_date_utc"
      required
      readonly
    />
    <mat-datepicker-toggle matSuffix [for]="picker1"></mat-datepicker-toggle>
    <mat-datepicker #picker1></mat-datepicker>
    <mat-error
      *ngIf="paymentForm.get('payee_added_date_utc')?.hasError('required')"
    >
      Added date is required.
    </mat-error>
  </mat-form-field>

  <mat-form-field appearance="fill" class="full-width">
    <mat-label>Due Date</mat-label>
    <input
      matInput
      [matDatepicker]="picker2"
      formControlName="payee_due_date"
      required
    />
    <mat-datepicker-toggle matSuffix [for]="picker2"></mat-datepicker-toggle>
    <mat-datepicker #picker2></mat-datepicker>
    <mat-error *ngIf="paymentForm.get('payee_due_date')?.hasError('required')">
      Due date is required.
    </mat-error>
  </mat-form-field>

  <mat-form-field appearance="fill" class="full-width">
    <mat-label>Due Amount</mat-label>
    <input matInput type="number" formControlName="due_amount" required />
    <mat-error *ngIf="paymentForm.get('due_amount')?.hasError('required')">
      Due amount is required.
    </mat-error>
    <mat-error *ngIf="paymentForm.get('due_amount')?.hasError('min')">
      Due amount must be greater than 0.
    </mat-error>
  </mat-form-field>

  <mat-form-field appearance="fill" class="full-width">
    <mat-label>Address Line 1</mat-label>
    <input matInput formControlName="payee_address_line_1" required readonly />
    <mat-error
      *ngIf="paymentForm.get('payee_address_line_1')?.hasError('required')"
    >
      Address Line 1 is required
    </mat-error>
  </mat-form-field>

  <mat-form-field appearance="fill" class="full-width">
    <mat-label>Address Line 2</mat-label>
    <input matInput formControlName="payee_address_line_2" required readonly />
    <mat-error
      *ngIf="paymentForm.get('payee_address_line_2')?.hasError('required')"
    >
      Address Line 2 is required
    </mat-error>
  </mat-form-field>

  <mat-form-field appearance="fill" class="full-width">
    <mat-label>City</mat-label>
    <input matInput formControlName="payee_city" required readonly />
    <mat-error *ngIf="paymentForm.get('payee_city')?.hasError('required')">
      City is required.
    </mat-error>
  </mat-form-field>

  <mat-form-field appearance="fill" class="full-width">
    <mat-label>Province or State</mat-label>
    <input
      matInput
      formControlName="payee_province_or_state"
      required
      readonly
    />
    <mat-error
      *ngIf="paymentForm.get('payee_province_or_state')?.hasError('required')"
    >
      Province/state is required.
    </mat-error>
  </mat-form-field>

  <mat-form-field appearance="fill" class="full-width">
    <mat-label>Country</mat-label>
    <input matInput formControlName="payee_country" required readonly />
    <mat-error *ngIf="paymentForm.get('payee_country')?.hasError('required')">
      Country is required.
    </mat-error>
  </mat-form-field>

  <mat-form-field appearance="fill" class="full-width">
    <mat-label>Postal Code</mat-label>
    <input matInput formControlName="payee_postal_code" required readonly />
    <mat-error
      *ngIf="paymentForm.get('payee_postal_code')?.hasError('required')"
    >
      Postal code is required.
    </mat-error>
  </mat-form-field>

  <mat-form-field appearance="fill" class="full-width">
    <mat-label>Phone Number</mat-label>
    <input matInput formControlName="payee_phone_number" required readonly />
    <mat-error
      *ngIf="paymentForm.get('payee_phone_number')?.hasError('required')"
    >
      Phone number is required.
    </mat-error>
  </mat-form-field>

  <mat-form-field appearance="fill" class="full-width">
    <mat-label>Email</mat-label>
    <input
      matInput
      type="email"
      formControlName="payee_email"
      required
      readonly
    />
    <mat-error *ngIf="paymentForm.get('payee_email')?.hasError('required')">
      Email is required.
    </mat-error>
    <mat-error *ngIf="paymentForm.get('payee_email')?.hasError('email')">
      Invalid email format.
    </mat-error>
  </mat-form-field>

  <mat-form-field appearance="fill" class="full-width">
    <mat-label>Currency</mat-label>
    <input matInput formControlName="currency" required readonly />
    <mat-error *ngIf="paymentForm.get('currency')?.hasError('required')">
      Currency is required.
    </mat-error>
  </mat-form-field>

  <mat-form-field appearance="fill" class="full-width">
    <mat-label>Tax Percent</mat-label>
    <input matInput formControlName="tax_percent" required readonly />
    <mat-error *ngIf="paymentForm.get('tax_percent')?.hasError('required')">
      Tax percent is required.
    </mat-error>
  </mat-form-field>

  <mat-form-field appearance="fill" class="full-width">
    <mat-label>Discount Percent</mat-label>
    <input matInput formControlName="discount_percent" required readonly />
    <mat-error
      *ngIf="paymentForm.get('discount_percent')?.hasError('required')"
    >
      Discount percent is required.
    </mat-error>
  </mat-form-field>

  <mat-form-field>
    <mat-select
      placeholder="Payment Status"
      formControlName="payee_payment_status"
      (selectionChange)="onStatusChange()"
    >
      <mat-option value="pending">Pending</mat-option>
      <mat-option value="due_now">Due Now</mat-option>
      <mat-option value="completed">Completed</mat-option>
    </mat-select>

    <mat-error
      *ngIf="paymentForm.get('payee_payment_status')?.hasError('required')"
    >
      Status is required
    </mat-error>
    <mat-error *ngIf="statusError">
      Evidence is required to mark as completed
    </mat-error>
  </mat-form-field>

  <mat-label *ngIf="statusError"
    >Upload evidence before updating payment</mat-label
  >

  <div
    class="file-upload"
    *ngIf="paymentForm.get('payee_payment_status')?.value === 'completed'"
  >
    <label for="evidenceUpload">Upload Evidence</label>

    <input type="file" id="evidenceUpload" (change)="onFileUpload($event)" />
  </div>

  <button
    mat-raised-button
    color="primary"
    type="submit"
    [disabled]="!paymentForm.valid || statusError"
  >
    Update Payment
  </button>
</form>
